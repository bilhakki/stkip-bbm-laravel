import{f as u}from"./fetch-b8ff0b47.js";import{C as c}from"./choices-b42e1b7a.js";const f=({method:r})=>{const e="selectStudents";return{selectStudents:{el:null,url:null,urlSearch:{},data:[]},async initSelectStudents(){this[e].el=new c(`form.${r} [name="student_id"]`,{silent:!0,allowHTML:!1,searchResultLimit:10,renderSelectedChoices:"always",searchPlaceholderValue:"Cari mahasiswa"}),this[e].url=this[e].el.passedElement.element.getAttribute("data-url"),this[e].urlSearch={},this[e].data=[],this.fetchStudents(),this[e].el.passedElement.element.addEventListener("search",async t=>{const n=t.detail.value;this[e].urlSearch={s_name:n},this.fetchStudents()},!1),this[e].el.passedElement.element.addEventListener("showDropdown",async()=>{this[e].el.input.element.value=this[e].urlSearch.s_name??""},!1)},fetchStudents:async function(){return new Promise((t,n)=>{this[e].fetchTimeout&&(clearTimeout(this[e].fetchTimeout),t([])),this[e].fetchTimeout=setTimeout(()=>{let i=this[e].url;Object.keys(this[e].urlSearch).length>0&&(i+=`?${new URLSearchParams(this[e].urlSearch).toString()}`),u(i).then(s=>{const{data:h}=s,a=h.map((l,d)=>({label:l.user.name,value:l.id,selected:l.id==this.body.student_id}));this[e].data=a,this[e].el.setChoices(a,"value","label",!0),t(a)}).catch(s=>{console.log("ðŸš€ ~ file: selectStudents.js:90 ~ fetch ~ error:",s),t([])})},500)})},async fetchCurrentStudent(){this[e].urlSearch={s_id:this.body.student_id},await this.fetchStudents()}}};export{f as s};
